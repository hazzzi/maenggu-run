{
  "title": "맹구런 - 데스크탑 펫 앱",
  "overview": "화면 위를 돌아다니는 픽셀 강아지 데스크탑 펫. 사용자가 자신의 반려동물로 커스터마이징할 수 있는 것이 최종 목표.",
  "features": [
    {
      "id": "v0.1.0",
      "title": "v0.1.0: Tauri 마이그레이션",
      "status": "done",
      "background": "v1은 Electron으로 구현. 앱 크기가 ~100MB로 너무 컸음.",
      "goal": "Tauri로 전환하여 앱 크기 90% 감소 (~10MB) + 성능 개선",
      "outcome": "완료. 8.6MB 달성. macOS Spaces 지원 포함.",
      "items": [
        { "id": "setup", "title": "프로젝트 초기 설정", "status": "done" },
        {
          "id": "window-core",
          "title": "오버레이 창 기본 설정",
          "status": "done"
        },
        { "id": "window-mouse", "title": "클릭 통과 시스템", "status": "done" },
        { "id": "save-system", "title": "저장/로드 시스템", "status": "done" },
        { "id": "snack-state", "title": "간식 상태 관리", "status": "done" },
        { "id": "maenggu-render", "title": "맹구 렌더링", "status": "done" },
        {
          "id": "animation-system",
          "title": "애니메이션 시스템",
          "status": "done"
        },
        { "id": "movement-system", "title": "이동 시스템", "status": "done" },
        {
          "id": "interaction-click",
          "title": "클릭 상호작용",
          "status": "done"
        },
        {
          "id": "interaction-feed",
          "title": "먹이주기 상호작용",
          "status": "done"
        },
        { "id": "ui-snack", "title": "간식 UI", "status": "done" },
        { "id": "tray-menu", "title": "트레이 메뉴", "status": "done" },
        {
          "id": "refactor-game-loop",
          "title": "게임 루프 리팩터링",
          "status": "done"
        },
        {
          "id": "tauri-setup",
          "title": "Tauri 프로젝트 초기화",
          "status": "done"
        },
        {
          "id": "tauri-window",
          "title": "투명 창 + 클릭 통과",
          "status": "done"
        },
        {
          "id": "tauri-state",
          "title": "간식 상태 관리 (Rust)",
          "status": "done"
        },
        {
          "id": "tauri-save",
          "title": "저장/로드 시스템 (Rust)",
          "status": "done"
        },
        { "id": "tauri-tray", "title": "트레이 메뉴 (Rust)", "status": "done" },
        { "id": "tauri-build", "title": "빌드 & 배포 설정", "status": "done" },
        {
          "id": "cleanup-electron",
          "title": "Electron 코드 정리",
          "status": "done"
        }
      ]
    },
    {
      "id": "v0.2.0",
      "title": "v0.2.0: Summon & Spaces",
      "status": "done",
      "background": "맹구가 어디 있는지 찾기 어려울 때가 있고, macOS 가상 데스크탑(Spaces) 전환 시 맹구가 안 보임.",
      "goal": "트레이 메뉴에서 맹구 부르기 + 모든 Spaces에서 맹구가 보이도록",
      "outcome": "완료. summon 이벤트 + MovementTarget Tagged Union으로 구현. NSWindowCollectionBehaviorCanJoinAllSpaces 설정.",
      "items": [
        {
          "id": "summon-types",
          "title": "GameEvent 타입 추가",
          "status": "done"
        },
        {
          "id": "summon-target-union",
          "title": "MovementTarget Tagged Union",
          "status": "done"
        },
        {
          "id": "summon-speed",
          "title": "SUMMON_SPEED 상수",
          "status": "done"
        },
        {
          "id": "summon-handler",
          "title": "handleSummon 로직",
          "status": "done"
        },
        { "id": "summon-tray", "title": "트레이 메뉴 항목", "status": "done" },
        { "id": "summon-bridge", "title": "JS 이벤트 연결", "status": "done" },
        {
          "id": "spaces-behavior",
          "title": "NSWindowCollectionBehavior 설정",
          "status": "done"
        },
        {
          "id": "spaces-objc2",
          "title": "objc2-app-kit 마이그레이션",
          "status": "done"
        }
      ]
    },
    {
      "id": "v0.2.1",
      "title": "v0.2.1: 버그 수정",
      "status": "in_progress",
      "background": "동생(Windows)과 동료(macOS 멀티모니터)에게서 버그 제보 받음.",
      "goal": "안정성 개선 - 게임 방해 없이, 멀티모니터에서도 정상 동작",
      "items": [
        {
          "id": "bug-win-focus",
          "title": "[Windows] 클릭 시 게임 화면 전환",
          "status": "done",
          "symptom": "풀스크린 게임 중 맹구 클릭 → 게임이 백그라운드로 밀림",
          "cause": "맹구 창이 포커스를 가져가면서 풀스크린 앱이 전환됨",
          "solution": "Windows에서 WS_EX_NOACTIVATE + WS_EX_TOOLWINDOW 스타일 적용"
        },
        {
          "id": "bug-sleep-speed",
          "title": "[공통] Sleep 후 빠른 움직임",
          "status": "done",
          "symptom": "화면 꺼놨다 다시 켜면 맹구가 순간이동 수준으로 빠름",
          "cause": "deltaMs가 sleep 시간(수십~수백초)을 포함하여 한 프레임에 엄청난 거리 이동",
          "solution": "MAX_DELTA_MS 상한선(100ms) 추가"
        },
        {
          "id": "bug-multimon-bounds",
          "title": "[멀티모니터] 화면 밖 벗어남",
          "status": "done",
          "symptom": "3모니터(좌-하단-우 배치)에서 맹구가 화면 밖으로 나감",
          "cause": "calculate_total_monitor_bounds가 physical pixel 크기를 단순 합산. Monitor 2(scale=2)의 physical size를 logical 좌표 공간에 그대로 사용하여 창 크기가 실제 가시 영역보다 훨씬 커짐",
          "bugReport": "Monitor1: pos=(0,0) 3840x2160 scale=1 | Monitor2: pos=(7680,2294) 4112x2658 scale=2 | Monitor3: pos=(1920,2160) 1280x720 scale=1 | Window: 11792x4952 pos=(0,-2792) scale=1",
          "solution": "set_position/set_size에 PhysicalSize 대신 LogicalSize/LogicalPosition 사용. 모니터 size를 scale로 나눠서 logical 좌표로 통일"
        },
        {
          "id": "bug-hidpi-render",
          "title": "[고해상도] 스프라이트 깨짐",
          "status": "blocked",
          "blockedBy": "bug-report",
          "symptom": "고해상도 모니터에서 픽셀이 일정하지 않게 보임",
          "cause": "추가 조사 필요 - 버그 리포트 기능으로 환경 정보 수집 후 수정"
        },
        {
          "id": "bug-report",
          "title": "버그 리포트 기능",
          "status": "done",
          "goal": "트레이 메뉴에서 시스템 정보 수집 → 클립보드 복사",
          "info": [
            "OS 정보",
            "모니터 개수/위치/크기/scale",
            "Window physical/CSS pixels",
            "앱 버전"
          ]
        }
      ]
    },
    {
      "id": "v0.2.2",
      "title": "v0.2.2: UX 개선",
      "status": "done",
      "background": "Issue #5 기능 요청. 더 생동감 있고 유용한 데스크탑 펫 경험 제공.",
      "goal": "부르기 단축키, 밥시간 알림, 잠자기 상태 추가",
      "items": [
        {
          "id": "ux-summon-shortcut",
          "title": "부르기 단축키",
          "status": "done",
          "goal": "글로벌 단축키로 맹구 부르기 (트레이 메뉴 안 거치고)",
          "solution": "Cmd+Shift+M (macOS) / Ctrl+Shift+M (Windows)"
        },
        {
          "id": "ux-meal-reminder",
          "title": "밥시간 알림",
          "status": "done",
          "goal": "11:50, 17:50에 말풍선으로 '맘마 10분전! ><' 알림",
          "solution": "SpeechBubble 컴포넌트 + useMealReminder 훅. 5초간 표시 후 fade out"
        },
        {
          "id": "ux-sleep-state",
          "title": "잠자기 상태",
          "status": "done",
          "goal": "오래 방치 시 구석에서 자는 모습",
          "solution": "마지막 상호작용 이후 10분 → sleep 전환 (500ms/frame). 클릭 → happy 깨우기, summon → walk 깨우기. idle/walk 무관하게 타이머 누적, 상호작용 시 리셋"
        },
        {
          "id": "ux-settings",
          "title": "설정 커스텀",
          "status": "backlog",
          "goal": "트레이 메뉴에서 설정 창 열어서 알림 시간/메시지 수정",
          "notes": "다음 버전에서 진행. 설정 창 UI + save.json에 저장"
        }
      ]
    },
    {
      "id": "v3-custom-sprite",
      "title": "v3: 커스텀 스프라이트",
      "status": "planning",
      "background": "사용자가 자신의 반려동물을 데스크탑 펫으로 쓰고 싶어함.",
      "goal": "AI로 반려동물 사진 → 픽셀아트 스프라이트 자동 생성. 일반 유저도 쉽게 사용 가능.",
      "decisions": [
        {
          "question": "스프라이트 로딩 방식을 어떻게 할까?",
          "answer": "매니페스트(sprite.json) 기반 단일 방식",
          "reason": "최종 목표가 AI 생성이므로, AI가 이미지 + 매니페스트를 함께 생성하면 됨. 폴더 자동감지 같은 편의 기능은 과적합. 파워유저는 스펙 보고 직접 만들 수 있음."
        },
        {
          "question": "새 상태(예: sleep) 추가되면?",
          "answer": "매니페스트에 상태 정의 + fallback 규칙으로 해결",
          "reason": "커스텀 스프라이트가 새 상태를 지원 안 하면 fallback 상태(idle) 사용. 하위 호환성 유지."
        }
      ],
      "spec": {
        "spritePack": {
          "description": "스프라이트 팩은 앱이 로드하는 단일 단위. 메타데이터 + 상태별 프레임으로 구성.",
          "manifestFile": "sprite.json",
          "manifestSchema": {
            "name": "string - 스프라이트 팩 이름",
            "version": "number - 스펙 버전 (현재 1)",
            "frameSize": "number - 프레임 크기 (정사각형, 픽셀 단위)",
            "states": {
              "[stateName]": {
                "frames": "string[] - 프레임 이미지 경로 (상대 경로)",
                "loop": "boolean - 반복 여부",
                "frameDuration": "number? - 프레임당 ms (기본값 200)"
              }
            },
            "fallback": "string - 없는 상태일 때 대체할 상태명"
          },
          "example": {
            "name": "나의 강아지",
            "version": 1,
            "frameSize": 32,
            "states": {
              "idle": { "frames": ["idle/01.png"], "loop": true },
              "walk": {
                "frames": ["walk/01.png", "walk/02.png", "walk/03.png"],
                "loop": true
              },
              "eat": {
                "frames": [
                  "eat/01.png",
                  "eat/02.png",
                  "eat/03.png",
                  "eat/04.png",
                  "eat/05.png"
                ],
                "loop": false
              },
              "happy": { "frames": ["happy/01.png"], "loop": false }
            },
            "fallback": "idle"
          },
          "requiredStates": ["idle", "walk", "eat", "happy"],
          "notes": "requiredStates는 앱이 반드시 사용하는 상태. 이 상태들이 없으면 로딩 실패."
        }
      },
      "phases": [
        {
          "id": "phase1",
          "title": "Phase 1: 스프라이트 팩 로더",
          "status": "done",
          "goal": "매니페스트 기반 스프라이트 로딩 시스템 구축",
          "items": [
            {
              "id": "sp-types",
              "title": "SpritePack 타입 정의",
              "status": "done",
              "steps": [
                "shared/types.ts: SpriteManifest, SpritePack 타입 추가",
                "상태별 프레임 정보, fallback 로직 포함"
              ]
            },
            {
              "id": "sp-loader",
              "title": "스프라이트 팩 로더 구현",
              "status": "done",
              "steps": [
                "game/sprite-pack.ts: loadSpritePack(path) 함수",
                "매니페스트 파싱 + 유효성 검사 (requiredStates 확인)",
                "getFrameUrls, getStateConfig, getFrameCount 등 헬퍼 함수"
              ]
            },
            {
              "id": "sp-fallback",
              "title": "fallback 로직 구현",
              "status": "done",
              "steps": [
                "getStateConfig에서 상태 없으면 fallback 반환",
                "validateManifest에서 fallback 존재 여부 검증"
              ]
            },
            {
              "id": "sp-manifest",
              "title": "맹구 기본 스프라이트 매니페스트",
              "status": "done",
              "steps": ["assets/sprite.json 생성"]
            },
            {
              "id": "sp-integrate-loader",
              "title": "SpritePack 로딩 시스템",
              "status": "done",
              "goal": "useMaenggu에서 SpritePack 비동기 로딩 + 상태 관리",
              "steps": [
                "useMaenggu에 spritePack 상태 추가",
                "useEffect로 loadSpritePack 호출",
                "로딩 중/에러 상태 처리"
              ]
            },
            {
              "id": "sp-integrate-anim",
              "title": "애니메이션 SpritePack 연동",
              "status": "done",
              "goal": "update-animation이 SpritePack에서 duration/loop 조회",
              "steps": [
                "updateAnimation에 SpritePack 파라미터 추가",
                "LOOPING_STATES → isLoopingState(pack, state)",
                "STATE_FRAME_DURATION → getFrameDuration(pack, state)",
                "호출부(update.ts) 수정"
              ]
            },
            {
              "id": "sp-integrate-render",
              "title": "Maenggu 렌더링 SpritePack 연동",
              "status": "done",
              "goal": "Maenggu가 SpritePack에서 프레임 URL 조회",
              "steps": [
                "Maenggu에 spritePack prop 추가",
                "getSpriteFrameUrls → getFrameUrls(pack, state)",
                "App.tsx에서 spritePack 전달"
              ]
            },
            {
              "id": "sp-integrate-cleanup",
              "title": "레거시 sprite-loader 정리",
              "status": "done",
              "goal": "하드코딩된 sprite-loader.ts 삭제",
              "steps": [
                "sprite-loader.ts 삭제",
                "관련 테스트 정리",
                "import 경로 정리"
              ]
            },
            {
              "id": "sp-settings",
              "title": "설정에서 스프라이트 팩 선택",
              "status": "done",
              "steps": [
                "트레이 메뉴에 '스프라이트 변경' 추가",
                "폴더 선택 다이얼로그 → 로드 → 적용",
                "선택한 경로 저장 (save.json)"
              ]
            }
          ]
        },
        {
          "id": "phase2",
          "title": "Phase 2: AI 스프라이트 생성",
          "status": "blocked",
          "blockedBy": "phase1",
          "goal": "사진 업로드 → AI가 스프라이트 팩 자동 생성",
          "notes": "Phase 1 완료 후 상세 설계. AI 모델 선정, 프롬프트 설계, 생성 파이프라인 구축 필요.",
          "items": []
        }
      ]
    },
    {
      "id": "feature-home",
      "title": "맹구 집",
      "status": "backlog",
      "background": "동료 피드백: 맹구 집이 있으면 좋겠다",
      "goal": "화면 구석에 집 스프라이트 배치, 클릭하면 맹구가 집으로 가서 잠",
      "concept": {
        "flow": [
          "화면 한쪽 구석에 집 아이콘 고정 배치",
          "집 클릭 → 맹구가 집으로 걸어감 (summon 역방향)",
          "집 도착 → sleep 상태 진입",
          "클릭/summon으로 깨우면 다시 돌아다님"
        ],
        "openQuestions": [
          "집 위치: 고정? 사용자 지정?",
          "집에 있을 때 렌더링: 집 안에 숨김? 집 앞에서 자는 모습?",
          "트레이 메뉴에 '집으로 보내기' 추가?"
        ]
      },
      "dependencies": ["v3-custom-sprite"],
      "notes": "집 스프라이트 에셋 필요. v3 스프라이트 작업 후 진행 권장."
    }
  ]
}
