{
  "title": "맹구런 - 데스크탑 펫 앱",
  "overview": "화면 위를 돌아다니는 픽셀 강아지 데스크탑 펫. 사용자가 자신의 반려동물로 커스터마이징할 수 있는 것이 최종 목표.",
  "features": [
    {
      "id": "v2-tauri-migration",
      "title": "v2: Tauri 마이그레이션",
      "status": "done",
      "background": "v1은 Electron으로 구현. 앱 크기가 ~100MB로 너무 컸음.",
      "goal": "Tauri로 전환하여 앱 크기 90% 감소 (~10MB) + 성능 개선",
      "outcome": "완료. 8.6MB 달성. macOS Spaces 지원 포함.",
      "items": [
        { "id": "setup", "title": "프로젝트 초기 설정", "status": "done" },
        { "id": "window-core", "title": "오버레이 창 기본 설정", "status": "done" },
        { "id": "window-mouse", "title": "클릭 통과 시스템", "status": "done" },
        { "id": "save-system", "title": "저장/로드 시스템", "status": "done" },
        { "id": "snack-state", "title": "간식 상태 관리", "status": "done" },
        { "id": "maenggu-render", "title": "맹구 렌더링", "status": "done" },
        { "id": "animation-system", "title": "애니메이션 시스템", "status": "done" },
        { "id": "movement-system", "title": "이동 시스템", "status": "done" },
        { "id": "interaction-click", "title": "클릭 상호작용", "status": "done" },
        { "id": "interaction-feed", "title": "먹이주기 상호작용", "status": "done" },
        { "id": "ui-snack", "title": "간식 UI", "status": "done" },
        { "id": "tray-menu", "title": "트레이 메뉴", "status": "done" },
        { "id": "refactor-game-loop", "title": "게임 루프 리팩터링", "status": "done" },
        { "id": "tauri-setup", "title": "Tauri 프로젝트 초기화", "status": "done" },
        { "id": "tauri-window", "title": "투명 창 + 클릭 통과", "status": "done" },
        { "id": "tauri-state", "title": "간식 상태 관리 (Rust)", "status": "done" },
        { "id": "tauri-save", "title": "저장/로드 시스템 (Rust)", "status": "done" },
        { "id": "tauri-tray", "title": "트레이 메뉴 (Rust)", "status": "done" },
        { "id": "tauri-build", "title": "빌드 & 배포 설정", "status": "done" },
        { "id": "cleanup-electron", "title": "Electron 코드 정리", "status": "done" }
      ]
    },
    {
      "id": "v2.1-summon",
      "title": "v2.1: 맹구 부르기",
      "status": "done",
      "background": "맹구가 어디 있는지 찾기 어려울 때가 있음.",
      "goal": "트레이 메뉴에서 '맹구 부르기' 클릭 시 마우스 위치로 빠르게 달려오기",
      "outcome": "완료. summon 이벤트 + MovementTarget Tagged Union으로 구현.",
      "items": [
        { "id": "summon-types", "title": "GameEvent 타입 추가", "status": "done" },
        { "id": "summon-target-union", "title": "MovementTarget Tagged Union", "status": "done" },
        { "id": "summon-speed", "title": "SUMMON_SPEED 상수", "status": "done" },
        { "id": "summon-handler", "title": "handleSummon 로직", "status": "done" },
        { "id": "summon-tray", "title": "트레이 메뉴 항목", "status": "done" },
        { "id": "summon-bridge", "title": "JS 이벤트 연결", "status": "done" }
      ]
    },
    {
      "id": "v2.2-spaces",
      "title": "v2.2: macOS Spaces 지원",
      "status": "done",
      "background": "macOS 가상 데스크탑(Spaces) 전환 시 맹구가 안 보임.",
      "goal": "모든 Spaces에서 맹구가 보이도록",
      "outcome": "완료. NSWindowCollectionBehaviorCanJoinAllSpaces 설정.",
      "items": [
        { "id": "spaces-behavior", "title": "NSWindowCollectionBehavior 설정", "status": "done" },
        { "id": "spaces-objc2", "title": "objc2-app-kit 마이그레이션", "status": "done" }
      ]
    },
    {
      "id": "v2.3-bugfix",
      "title": "v2.3: 버그 수정",
      "status": "in_progress",
      "background": "동생(Windows)과 동료(macOS 멀티모니터)에게서 버그 제보 받음.",
      "goal": "안정성 개선 - 게임 방해 없이, 멀티모니터에서도 정상 동작",
      "items": [
        {
          "id": "bug-win-focus",
          "title": "[Windows] 클릭 시 게임 화면 전환",
          "status": "done",
          "symptom": "풀스크린 게임 중 맹구 클릭 → 게임이 백그라운드로 밀림",
          "cause": "맹구 창이 포커스를 가져가면서 풀스크린 앱이 전환됨",
          "solution": "Windows에서 WS_EX_NOACTIVATE + WS_EX_TOOLWINDOW 스타일 적용"
        },
        {
          "id": "bug-sleep-speed",
          "title": "[공통] Sleep 후 빠른 움직임",
          "status": "done",
          "symptom": "화면 꺼놨다 다시 켜면 맹구가 순간이동 수준으로 빠름",
          "cause": "deltaMs가 sleep 시간(수십~수백초)을 포함하여 한 프레임에 엄청난 거리 이동",
          "solution": "MAX_DELTA_MS 상한선(100ms) 추가"
        },
        {
          "id": "bug-multimon-bounds",
          "title": "[멀티모니터] 화면 밖 벗어남",
          "status": "blocked",
          "blockedBy": "bug-report",
          "symptom": "3모니터(좌-하단-우 배치)에서 맹구가 화면 밖으로 나감",
          "cause": "추가 조사 필요 - 버그 리포트 기능으로 환경 정보 수집 후 수정"
        },
        {
          "id": "bug-hidpi-render",
          "title": "[고해상도] 스프라이트 깨짐",
          "status": "blocked",
          "blockedBy": "bug-report",
          "symptom": "고해상도 모니터에서 픽셀이 일정하지 않게 보임",
          "cause": "추가 조사 필요 - 버그 리포트 기능으로 환경 정보 수집 후 수정"
        },
        {
          "id": "bug-report",
          "title": "버그 리포트 기능",
          "status": "done",
          "goal": "트레이 메뉴에서 시스템 정보 수집 → 클립보드 복사",
          "info": ["OS 정보", "모니터 개수/위치/크기/scale", "Window physical/CSS pixels", "앱 버전"]
        }
      ]
    },
    {
      "id": "v2.4-ux",
      "title": "v2.4: UX 개선",
      "status": "planning",
      "background": "Issue #5 기능 요청. 더 생동감 있고 유용한 데스크탑 펫 경험 제공.",
      "goal": "부르기 단축키, 밥시간 알림, 잠자기 상태 추가",
      "items": [
        {
          "id": "ux-summon-shortcut",
          "title": "부르기 단축키",
          "status": "done",
          "goal": "글로벌 단축키로 맹구 부르기 (트레이 메뉴 안 거치고)",
          "solution": "Cmd+Shift+M (macOS) / Ctrl+Shift+M (Windows)"
        },
        {
          "id": "ux-meal-reminder",
          "title": "밥시간 알림",
          "status": "todo",
          "goal": "11:50, 17:50에 말풍선으로 '맘마 10분전! ><' 알림",
          "notes": "시간 체크 로직 + 말풍선 UI. 시간 설정 가능하게 할지?"
        },
        {
          "id": "ux-sleep-state",
          "title": "잠자기 상태",
          "status": "todo",
          "goal": "오래 방치 시 구석에서 자는 모습",
          "notes": "새 상태(sleep) + 스프라이트 필요. 방치 시간 기준 정의 필요 (예: 10분?)"
        }
      ]
    },
    {
      "id": "v3-custom-sprite",
      "title": "v3: 커스텀 스프라이트",
      "status": "planning",
      "background": "사용자가 자신의 반려동물을 데스크탑 펫으로 쓰고 싶어함.",
      "goal": "AI로 반려동물 사진 → 픽셀아트 스프라이트 자동 생성. 일반 유저도 쉽게 사용 가능.",
      "decisions": [
        {
          "question": "스프라이트 로딩 방식을 어떻게 할까?",
          "answer": "매니페스트(sprite.json) 기반 단일 방식",
          "reason": "최종 목표가 AI 생성이므로, AI가 이미지 + 매니페스트를 함께 생성하면 됨. 폴더 자동감지 같은 편의 기능은 과적합. 파워유저는 스펙 보고 직접 만들 수 있음."
        },
        {
          "question": "새 상태(예: sleep) 추가되면?",
          "answer": "매니페스트에 상태 정의 + fallback 규칙으로 해결",
          "reason": "커스텀 스프라이트가 새 상태를 지원 안 하면 fallback 상태(idle) 사용. 하위 호환성 유지."
        }
      ],
      "spec": {
        "spritePack": {
          "description": "스프라이트 팩은 앱이 로드하는 단일 단위. 메타데이터 + 상태별 프레임으로 구성.",
          "manifestFile": "sprite.json",
          "manifestSchema": {
            "name": "string - 스프라이트 팩 이름",
            "version": "number - 스펙 버전 (현재 1)",
            "frameSize": "number - 프레임 크기 (정사각형, 픽셀 단위)",
            "states": {
              "[stateName]": {
                "frames": "string[] - 프레임 이미지 경로 (상대 경로)",
                "loop": "boolean - 반복 여부",
                "frameDuration": "number? - 프레임당 ms (기본값 200)"
              }
            },
            "fallback": "string - 없는 상태일 때 대체할 상태명"
          },
          "example": {
            "name": "나의 강아지",
            "version": 1,
            "frameSize": 32,
            "states": {
              "idle": { "frames": ["idle/01.png"], "loop": true },
              "walk": { "frames": ["walk/01.png", "walk/02.png", "walk/03.png"], "loop": true },
              "eat": { "frames": ["eat/01.png", "eat/02.png", "eat/03.png", "eat/04.png", "eat/05.png"], "loop": false },
              "happy": { "frames": ["happy/01.png"], "loop": false }
            },
            "fallback": "idle"
          },
          "requiredStates": ["idle", "walk", "eat", "happy"],
          "notes": "requiredStates는 앱이 반드시 사용하는 상태. 이 상태들이 없으면 로딩 실패."
        }
      },
      "phases": [
        {
          "id": "phase1",
          "title": "Phase 1: 스프라이트 팩 로더",
          "status": "in_progress",
          "goal": "매니페스트 기반 스프라이트 로딩 시스템 구축",
          "items": [
            {
              "id": "sp-types",
              "title": "SpritePack 타입 정의",
              "status": "done",
              "steps": [
                "shared/types.ts: SpriteManifest, SpritePack 타입 추가",
                "상태별 프레임 정보, fallback 로직 포함"
              ]
            },
            {
              "id": "sp-loader",
              "title": "스프라이트 팩 로더 구현",
              "status": "done",
              "steps": [
                "game/sprite-pack.ts: loadSpritePack(path) 함수",
                "매니페스트 파싱 + 유효성 검사 (requiredStates 확인)",
                "getFrameUrls, getStateConfig, getFrameCount 등 헬퍼 함수"
              ]
            },
            {
              "id": "sp-fallback",
              "title": "fallback 로직 구현",
              "status": "done",
              "steps": [
                "getStateConfig에서 상태 없으면 fallback 반환",
                "validateManifest에서 fallback 존재 여부 검증"
              ]
            },
            {
              "id": "sp-manifest",
              "title": "맹구 기본 스프라이트 매니페스트",
              "status": "done",
              "steps": [
                "assets/sprite.json 생성"
              ]
            },
            {
              "id": "sp-integrate",
              "title": "기존 코드 연동",
              "status": "todo",
              "steps": [
                "기존 sprite-loader.ts → sprite-pack.ts 사용하도록 전환",
                "Maenggu 컴포넌트가 SpritePack 기반으로 렌더링",
                "update-animation.ts가 SpritePack에서 프레임 수/루프 여부 조회"
              ]
            },
            {
              "id": "sp-settings",
              "title": "설정에서 스프라이트 팩 선택",
              "status": "todo",
              "steps": [
                "트레이 메뉴에 '스프라이트 변경' 추가",
                "폴더 선택 다이얼로그 → 로드 → 적용",
                "선택한 경로 저장 (save.json)"
              ]
            }
          ]
        },
        {
          "id": "phase2",
          "title": "Phase 2: AI 스프라이트 생성",
          "status": "blocked",
          "blockedBy": "phase1",
          "goal": "사진 업로드 → AI가 스프라이트 팩 자동 생성",
          "notes": "Phase 1 완료 후 상세 설계. AI 모델 선정, 프롬프트 설계, 생성 파이프라인 구축 필요.",
          "items": []
        }
      ]
    }
  ]
}
